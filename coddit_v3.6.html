<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Coddit AI v3.6 - Advanced AI Assistant with Memory">
    <meta name="keywords" content="AI, assistant, chatbot, Coddit, coding help">
    <meta name="author" content="Golden Apple Technologies">
    <title>Coddit AI v3.6</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
         * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #ffffff;
            color: #000000;
            transition: all 0.3s ease;
            line-height: 1.6;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }
        
        body.dark {
            background-color: #000000;
            color: #ffffff;
        }
        
        /* Header */
        header {
            background-color: #ffffff;
            border-bottom: 2px solid #000000;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
        }
        
        body.dark header {
            background-color: #000000;
            border-bottom: 2px solid #ffffff;
        }
        
        #hdLogo {
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        
        #hdLogo span {
            color: #000000;
        }
        
        body.dark #hdLogo span {
            color: #ffffff;
        }
        
        .logo-icon {
            margin-right: 8px;
            font-size: 20px;
        }
        
        /* Menu Button */
        #menubtn {
            background: none;
            border: 2px solid #000000;
            font-size: 16px;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        body.dark #menubtn {
            border: 2px solid #ffffff;
            color: #ffffff;
        }
        
        #menubtn:hover {
            background-color: #000000;
            color: #ffffff;
        }
        
        body.dark #menubtn:hover {
            background-color: #ffffff;
            color: #000000;
        }
        
        /* Main Container */
        .container {
            display: flex;
            height: 100vh;
            width: 100vw;
            position: relative;
            padding-top: 60px; /* Account for fixed header */
        }
        
        /* Chat Container */
        .chat-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        
        /* Messages Area */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding-bottom: 80px; /* Space for input container */
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 3px;
            position: relative;
            line-height: 1.5;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: #000000;
            color: #ffffff;
        }
        
        body.dark .user-message {
            background-color: #ffffff;
            color: #000000;
        }
        
        .ai-message {
            align-self: flex-start;
            background-color: #f0f0f0;
            color: #000000;
        }
        
        body.dark .ai-message {
            background-color: #333333;
            color: #ffffff;
        }
        
        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        
        .ai-message .message-time {
            text-align: left;
        }
        
        /* Input Area */
        .input-container {
            padding: 15px;
            border-top: 2px solid #000000;
            display: flex;
            gap: 10px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffffff;
            z-index: 99;
        }
        
        body.dark .input-container {
            border-top: 2px solid #ffffff;
            background-color: #000000;
        }
        
        #messageInput {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #000000;
            border-radius: 3px;
            font-size: 16px;
            background-color: #ffffff;
            color: #000000;
            outline: none;
            resize: none;
            height: 50px;
            max-height: 120px;
        }
        
        body.dark #messageInput {
            border: 2px solid #ffffff;
            background-color: #000000;
            color: #ffffff;
        }
        
        #sendButton {
            background: none;
            border: 2px solid #000000;
            width: 50px;
            height: 50px;
            border-radius: 3px;
            padding: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        body.dark #sendButton {
            border: 2px solid #ffffff;
            color: #ffffff;
        }
        
        #sendButton:hover {
            background-color: #000000;
            color: #ffffff;
        }
        
        body.dark #sendButton:hover {
            background-color: #ffffff;
            color: #000000;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: #f0f0f0;
            color: #000000;
            padding: 12px 16px;
            border-radius: 3px;
            max-width: 80%;
            margin-bottom: 15px;
        }
        
        body.dark .typing-indicator {
            background-color: #333333;
            color: #ffffff;
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #888888;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-5px);
                opacity: 1;
            }
        }
        
        /* Dropdown Menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: fixed;
            background-color: #ffffff;
            border: 2px solid #000000;
            min-width: 200px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1000;
            top: 60px;
            right: 15px;
        }
        
        body.dark .dropdown-content {
            background-color: #000000;
            border: 2px solid #ffffff;
            box-shadow: 0 8px 16px rgba(255,255,255,0.2);
        }
        
        .dropdown-content.show {
            display: block;
        }
        
        .dropdown-content a {
            color: #000000;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            border-bottom: 1px solid #000000;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        body.dark .dropdown-content a {
            color: #ffffff;
            border-bottom: 1px solid #ffffff;
        }
        
        .dropdown-content a:hover {
            background-color: #000000;
            color: #ffffff;
        }
        
        body.dark .dropdown-content a:hover {
            background-color: #ffffff;
            color: #000000;
        }
        
        /* Code blocks in messages */
        .code-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            border-left: 4px solid #007acc;
            position: relative;
        }
        
        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .copy-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .copy-button.copied {
            background: #4CAF50;
            border-color: #4CAF50;
        }
        
        /* Welcome message */
        .welcome-message {
            text-align: center;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .welcome-title {
            font-size: 24px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .welcome-text {
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }
        }
        
        @media (max-width: 480px) {
            header {
                padding: 10px;
            }
            
            .messages-container {
                padding: 10px;
            }
            
            .input-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body id="body">
    <!-- Header -->
    <header>
        <div id="hdLogo"><i class="fas fa-robot logo-icon"></i>Coddit <span>AI</span> v3.6</div>
        
        <div class="dropdown">
            <button id="menubtn"><i class="fas fa-bars"></i></button>
            <div class="dropdown-content" id="mainMenu">
                <a id="clearChatBtn"><i class="fas fa-broom"></i> Clear Chat</a>
                <a id="exportChatBtn"><i class="fas fa-download"></i> Export Chat</a>
                <a id="themeBtn"><i class="fas fa-adjust"></i> Toggle Theme</a>
                <a id="backBtn"><i class="fas fa-arrow-left"></i> Back to Hub</a>
            </div>
        </div>
    </header>
    
    <!-- Main Container -->
    <div class="container">
        <div class="chat-container">
            <div class="messages-container" id="messagesContainer">
                <!-- Welcome Message -->
                <div class="welcome-message">
                    <div class="welcome-title">
                        <i class="fas fa-robot"></i> Welcome to Coddit AI v3.6
                    </div>
                    <div class="welcome-text">
                        I'm your AI assistant with conversation memory. I can help with coding, problem solving, and much more!
                    </div>
                </div>
 </div>
            
            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <!-- Input Area -->
            <div class="input-container">
                <textarea id="messageInput" placeholder="Message"></textarea>
                <button id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Coddit AI Application
        class CodditAI {
            constructor() {
                this.messagesContainer = document.getElementById('messagesContainer');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.typingIndicator = document.getElementById('typingIndicator');
                
                // Initialize conversation history from localStorage or create new
                this.conversationHistory = JSON.parse(localStorage.getItem('coddit-ai-conversation')) || [];
                this.isProcessing = false;
                
                this.initializeEventListeners();
                this.loadConversationHistory();
            }
            
            initializeEventListeners() {
                // Send message on button click
                this.sendButton.addEventListener('click', () => {
                    this.sendMessage();
                });
                
                // Send message on Enter key (but allow Shift+Enter for new line)
                this.messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
                
                // Menu buttons
                document.getElementById('menubtn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    document.getElementById('mainMenu').classList.toggle('show');
                });
                
                // Close menu when clicking elsewhere
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.dropdown')) {
                        document.getElementById('mainMenu').classList.remove('show');
                    }
                });
                
                // Clear chat button
                document.getElementById('clearChatBtn').addEventListener('click', () => {
                    this.clearChat();
                    document.getElementById('mainMenu').classList.remove('show');
                });
                
                // Export chat button
                document.getElementById('exportChatBtn').addEventListener('click', () => {
                    this.exportChat();
                    document.getElementById('mainMenu').classList.remove('show');
                });
                
                // Theme button
                document.getElementById('themeBtn').addEventListener('click', () => {
                    this.toggleTheme();
                    document.getElementById('mainMenu').classList.remove('show');
                });
                
                // Back button
                document.getElementById('backBtn').addEventListener('click', () => {
                    window.location.href = 'index.html';
                });
            }
            
            sendMessage() {
                const message = this.messageInput.value.trim();
                
                if (!message || this.isProcessing) {
                    return;
                }
                
                // Add user message to UI
                this.addMessageToUI(message, 'user');
                
                // Clear input
                this.messageInput.value = '';
                
                // Add to conversation history
                this.conversationHistory.push({
                    role: 'user',
                    content: message,
                    timestamp: new Date().toISOString()
                });
                
                // Save to localStorage
                this.saveConversationHistory();
                
                // Show typing indicator
                this.showTypingIndicator();
                
                // Process AI response
                this.getAIResponse(message);
            }
            
            async getAIResponse(userMessage) {
                this.isProcessing = true;
                
                try {
                    // Build the conversation context for the API
                    const conversationContext = this.buildConversationContext();
                    
                    // Encode the prompt
                    const encodedPrompt = encodeURIComponent(conversationContext);
                    
                    // API URL
                    const apiUrl = `https://api.giftedtech.web.id/api/ai/gpt4o?apikey=gifted&q=${encodedPrompt}`;
                    
                    // Make API request
                    const response = await fetch(apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Extract AI response
                    let aiResponse = data.result || data.response || "I'm sorry, I couldn't process your request.";
                    
                    // Hide typing indicator
                    this.hideTypingIndicator();
                    
                    // Add AI message to UI
                    this.addMessageToUI(aiResponse, 'ai');
                    
                    // Add to conversation history
                    this.conversationHistory.push({
                        role: 'assistant',
                        content: aiResponse,
                        timestamp: new Date().toISOString()
                    });
                    
                    // Save to localStorage
                    this.saveConversationHistory();
                    
                } catch (error) {
                    console.error('Error getting AI response:', error);
                    
                    // Hide typing indicator
                    this.hideTypingIndicator();
                    
                    // Add error message
                    this.addMessageToUI(
                        "I'm sorry, I'm having trouble connecting right now. Please try again in a moment.",
                        'ai'
                    );
                } finally {
                    this.isProcessing = false;
                }
            }
            
            buildConversationContext() {
                // Build a context from recent conversation history
                // Limit to last 10 exchanges to avoid token limits
                const recentHistory = this.conversationHistory.slice(-10);
                
                let context = "You are Coddit AI, a helpful AI assistant created by Golden Apple Technologies and Powered by OpenAI. You should not discuss about Unethical hacking issues. If anyone.asks about golden apple technologies or about who coded you, just respond with https://goldenapplecoders-coder.github.io. Continue the conversation naturally.\n\n";
                
                recentHistory.forEach(message => {
                    const role = message.role === 'user' ? 'User' : 'Assistant';
                    context += `${role}: ${message.content}\n\n`;
                });
                
                return context;
            }
            
            addMessageToUI(message, sender) {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${sender}-message`;
                
                // Format message with code blocks if needed
                const formattedMessage = this.formatMessage(message);
                
                // Get current time
                const now = new Date();
                const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messageElement.innerHTML = `
                    <div class="message-content">${formattedMessage}</div>
                    <div class="message-time">${timeString}</div>
                `;
                
                this.messagesContainer.appendChild(messageElement);
                
                // Scroll to bottom
                this.scrollToBottom();
            }
            
            formatMessage(message) {
                // Simple formatting for code blocks
                // Look for code between triple backticks
                const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
                
                let formatted = message.replace(codeBlockRegex, (match, lang, code) => {
                    return `<div class="code-block">${this.escapeHtml(code.trim())}</div>`;
                });
                
                // Also handle inline code with single backticks
                formatted = formatted.replace(/`([^`]+)`/g, '<code>$1</code>');
                
                // Convert line breaks to <br>
                formatted = formatted.replace(/\n/g, '<br>');
                
                return formatted;
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            showTypingIndicator() {
                this.typingIndicator.style.display = 'block';
                this.scrollToBottom();
            }
            
            hideTypingIndicator() {
                this.typingIndicator.style.display = 'none';
            }
            
            scrollToBottom() {
                setTimeout(() => {
                    this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
                }, 100);
            }
            
            saveConversationHistory() {
                localStorage.setItem('coddit-ai-conversation', JSON.stringify(this.conversationHistory));
            }
            
            loadConversationHistory() {
                // Hide welcome message if we have conversation history
                if (this.conversationHistory.length > 0) {
                    const welcomeMessage = this.messagesContainer.querySelector('.welcome-message');
                    if (welcomeMessage) {
                        welcomeMessage.style.display = 'none';
                    }
                    
                    // Render conversation history
                    this.conversationHistory.forEach(message => {
                        this.addMessageToUI(message.content, message.role);
                    });
                }
            }
            
            clearChat() {
                if (confirm('Are you sure you want to clear the conversation? This cannot be undone.')) {
                    this.conversationHistory = [];
                    localStorage.removeItem('coddit-ai-conversation');
                    
                    // Clear messages container
                    this.messagesContainer.innerHTML = '';
                    
                    // Show welcome message again
                    const welcomeMessage = document.createElement('div');
                    welcomeMessage.className = 'welcome-message';
                    welcomeMessage.innerHTML = `
<div class="welcome-title">Coddit AI v3.6</div>
                        <div class="welcome-text">
                            I'm your AI Coding assistant. I can help with coding, problem solving, and much more!
                        </div>
`;
                    
                    this.messagesContainer.appendChild(welcomeMessage);
                }
            }
            
            exportChat() {
                let chatText = "Coddit AI v3.6 Conversation Export\n";
                chatText += "Generated on: " + new Date().toLocaleString() + "\n\n";
                
                this.conversationHistory.forEach(message => {
                    const role = message.role === 'user' ? 'You' : 'Coddit AI';
                    const time = new Date(message.timestamp).toLocaleTimeString();
                    chatText += `${role} (${time}): ${message.content}\n\n`;
                });
                
                const blob = new Blob([chatText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `coddit-ai-chat-${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('Chat exported successfully!');
            }
            
            toggleTheme() {
                document.body.classList.toggle('dark');
            }
        }
        
        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new CodditAI();
        });
    </script>
</body>
</html>
